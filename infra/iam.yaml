AWSTemplateFormatVersion: 2010-09-09

Parameters:
  BaseAccountId:
    Type: String
  TempPassword:
    Type: String

Resources:
  AdminUser:
    Type: AWS::IAM::User
    Properties:
      UserName: admin
      Groups:
        - !Ref AssumeRoleGroup
      LoginProfile:
        Password: !Ref TempPassword
        PasswordResetRequired: true

  AssumeRoleGroup:
    Type: AWS::IAM::Group
    Properties:
      GroupName: AssumeRole

  AdminUserAccessKey:
    Type: AWS::IAM::AccessKey
    Properties:
      UserName: !Ref AdminUser

  AssumeRolePolicy:
    Type: AWS::IAM::Policy
    Properties:
      Groups:
        - !Ref AssumeRoleGroup
      PolicyName: AssumeRole
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          Effect: Allow
          Action: sts:AssumeRole
          Resource: !Sub arn:aws:iam::${BaseAccountId}:role/SamhstnBaseRole

  AdminPolicy:
    Type: AWS::IAM::Policy
    Properties:
      Roles:
        - !Ref AdminRole
      PolicyName: AdminAccess
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          Effect: Allow
          Resource: '*'
          Action: '*'

  AdminRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: AdminRole
      MaxSessionDuration: 43200
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Principal:
              AWS: !GetAtt AdminUser.Arn
            Action: sts:AssumeRole

Outputs:
  AdminAccessKeyId:
    Value: !Ref SamhstnAdminUserAccessKey

  AdminSecretAccessKey:
    Value: !GetAtt SamhstnAdminUserAccessKey.SecretAccessKey
