version: 0.2

phases:
  install:
    commands:
      - mix deps.get
  pre_build:
    commands:
      - MIX_ENV=test mix compile
      - mix test
  build:
    commands:
      - MIX_ENV=prod mix compile
      - MIX_ENV=prod mix release
      - echo $S3_CODEBUILD_BUCKET_NAME
      - # aws s3 cp release stuff and appspec, {start,stop}-service.sh
      - # cp to codebuild bucket
  post_build:
    commands:
      - echo "CODEBUILD_RESOLVED_SOURCE_VERSION ${CODEBUILD_RESOLVED_SOURCE_VERSION}"
      - echo "CODEBUILD_SOURCE_VERSION ${CODEBUILD_SOURCE_VERSION}"
      - echo "ISSUE NUMBER ${ISSUE_NUMBER}"
      - ./infra/scripts/deploy_dynamic_build.sh
