version: 0.2

phases:
  install:
    commands:
      - apt-get update
      - apt-get install python-pip -y
      - python setup.py clean --all
      - python setup.py install
      - pip install cfn-lint
  build:
    commands:
      - |
        for FILE in $(find ./infra -name "*.yaml" -maxdepth 1);do
          if ! aws cloudformation validate-template --template-body "file://$FILE";then
            exit 1
          fi
        done
      - cfn-lint infra/*.yaml
      - npm test
